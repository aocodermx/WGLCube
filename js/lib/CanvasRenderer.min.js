THREE.SpriteCanvasMaterial=function(q){THREE.Material.call(this);this.type="SpriteCanvasMaterial";this.color=new THREE.Color(16777215);this.program=function(q,O){};this.setValues(q)};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial;THREE.SpriteCanvasMaterial.prototype.clone=function(){var q=new THREE.SpriteCanvasMaterial;q.copy(this);q.color.copy(this.color);q.program=this.program;return q};
THREE.CanvasRenderer=function(q){function Y(b,t,Ia,d){Z(t);aa(Ia);ba(d);H(b.getStyle());a.stroke();B.expandByScalar(2*t)}function O(b){D(b.getStyle());a.fill()}function qa(b){if(0===b.version||b instanceof THREE.CompressedTexture||b instanceof THREE.DataTexture)return{canvas:void 0,version:b.version};var t=b.image;if(!1===t.complete)return{canvas:void 0,version:0};var d=document.createElement("canvas");d.width=t.width;d.height=t.height;var f=d.getContext("2d");f.setTransform(1,0,0,-1,0,t.height);
f.drawImage(t,0,0);var t=b.wrapS===THREE.RepeatWrapping,f=b.wrapT===THREE.RepeatWrapping,c="no-repeat";!0===t&&!0===f?c="repeat":!0===t?c="repeat-x":!0===f&&(c="repeat-y");d=a.createPattern(d,c);if(b.onUpdate)b.onUpdate(b);return{canvas:d,version:b.version}}function ra(b,t,d,f,c,h,e,p,g,l,m,n,k){var v=P[k.id];if(void 0===v||v.version!==k.version)v=qa(k),P[k.id]=v;if(void 0!==v.canvas){D(v.canvas);var v=k.offset.x/k.repeat.x,r=k.offset.y/k.repeat.y,u=k.image.width*k.repeat.x;k=k.image.height*k.repeat.y;
e=(e+v)*u;p=(p+r)*k;d-=b;f-=t;c-=b;h-=t;g=(g+v)*u-e;l=(l+r)*k-p;m=(m+v)*u-e;n=(n+r)*k-p;k=g*n-m*l;0!==k&&(v=1/k,k=(n*d-l*c)*v,l=(n*f-l*h)*v,d=(g*c-m*d)*v,f=(g*h-m*f)*v,b=b-k*e-d*p,t=t-l*e-f*p,a.save(),a.transform(k,l,d,f,b,t),a.fill(),a.restore())}else D("rgba( 0, 0, 0, 1)"),a.fill()}function ca(b,a,d){var f=a.x-b.x,c=a.y-b.y,h=f*f+c*c;0!==h&&(d/=Math.sqrt(h),f*=d,c*=d,a.x+=f,a.y+=c,b.x-=f,b.y-=c)}function Q(b){da!==b&&(da=a.globalAlpha=b)}function R(b){ea!==b&&(b===THREE.NormalBlending?a.globalCompositeOperation=
"source-over":b===THREE.AdditiveBlending?a.globalCompositeOperation="lighter":b===THREE.SubtractiveBlending?a.globalCompositeOperation="darker":b===THREE.MultiplyBlending&&(a.globalCompositeOperation="multiply"),ea=b)}function Z(b){fa!==b&&(fa=a.lineWidth=b)}function aa(b){ga!==b&&(ga=a.lineCap=b)}function ba(b){ha!==b&&(ha=a.lineJoin=b)}function H(b){ia!==b&&(ia=a.strokeStyle=b)}function D(b){ja!==b&&(ja=a.fillStyle=b)}function sa(b){ta.length!==b.length&&(a.setLineDash(b),ta=b)}console.log("THREE.CanvasRenderer",
THREE.REVISION);q=q||{};var K=this,ka,la,L,Ja=new THREE.Projector,A=void 0!==q.canvas?q.canvas:document.createElement("canvas"),I=A.width,E=A.height,u=Math.floor(I/2),w=Math.floor(E/2),ua=0,va=0,wa=I,xa=E,x=1,a=A.getContext("2d",{alpha:!0===q.alpha}),J=new THREE.Color(0),F=!0===q.alpha?0:1,da=1,ea=0,ia=null,ja=null,fa=null,ga=null,ha=null,ta=[],f,r,C;new THREE.RenderableVertex;new THREE.RenderableVertex;var S,T,U,V,W,X,y=new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;
var ma=new THREE.Color,ya=new THREE.Color,na=new THREE.Color,P={},G,za,Aa,Ba,Ca,Da,Ea,M=new THREE.Box2,d=new THREE.Box2,B=new THREE.Box2,oa=new THREE.Color,Fa=new THREE.Color,Ga=new THREE.Color,pa=new THREE.Vector3,Ha=new THREE.Vector3,z=new THREE.Vector3,N=new THREE.Matrix3;void 0===a.setLineDash&&(a.setLineDash=function(){});this.domElement=A;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=
function(){};this.getContext=function(){return a};this.getContextAttributes=function(){return a.getContextAttributes()};this.getPixelRatio=function(){return x};this.setPixelRatio=function(b){void 0!==b&&(x=b)};this.setSize=function(b,a,f){I=b*x;E=a*x;A.width=I;A.height=E;u=Math.floor(I/2);w=Math.floor(E/2);!1!==f&&(A.style.width=b+"px",A.style.height=a+"px");M.min.set(-u,-w);M.max.set(u,w);d.min.set(-u,-w);d.max.set(u,w);da=1;ea=0;ha=ga=fa=ja=ia=null;this.setViewport(0,0,b,a)};this.setViewport=function(b,
a,d,f){ua=b*x;va=a*x;wa=d*x;xa=f*x};this.setScissor=function(){};this.setScissorTest=function(){};this.setClearColor=function(a,f){J.set(a);F=void 0!==f?f:1;d.min.set(-u,-w);d.max.set(u,w)};this.setClearColorHex=function(a,d){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");this.setClearColor(a,d)};this.getClearColor=function(){return J};this.getClearAlpha=function(){return F};this.getMaxAnisotropy=function(){return 0};this.clear=function(){!1===
d.isEmpty()&&(d.intersect(M),d.expandByScalar(2),d.min.x+=u,d.min.y=-d.min.y+w,d.max.x+=u,d.max.y=-d.max.y+w,1>F&&a.clearRect(d.min.x|0,d.max.y|0,d.max.x-d.min.x|0,d.min.y-d.max.y|0),0<F&&(R(THREE.NormalBlending),Q(1),D("rgba("+Math.floor(255*J.r)+","+Math.floor(255*J.g)+","+Math.floor(255*J.b)+","+F+")"),a.fillRect(d.min.x|0,d.max.y|0,d.max.x-d.min.x|0,d.min.y-d.max.y|0)),d.makeEmpty())};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(b,
t){if(!1===t instanceof THREE.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear();K.info.render.vertices=0;K.info.render.faces=0;a.setTransform(wa/I,0,0,-xa/E,ua,E-va);a.translate(u,w);ka=Ja.projectScene(b,t,this.sortObjects,this.sortElements);la=ka.elements;L=ka.lights;N.getNormalMatrix(t.matrixWorldInverse);oa.setRGB(0,0,0);Fa.setRGB(0,0,0);Ga.setRGB(0,0,0);for(var q=0,A=L.length;q<A;q++){var c=L[q],h=c.color;c instanceof
THREE.AmbientLight?oa.add(h):c instanceof THREE.DirectionalLight?Fa.add(h):c instanceof THREE.PointLight&&Ga.add(h)}q=0;for(A=la.length;q<A;q++){var e=la[q],p=e.material;if(void 0!==p&&0!==p.opacity){B.makeEmpty();if(e instanceof THREE.RenderableSprite){f=e;f.x*=u;f.y*=w;var c=f,g=e,h=p;Q(h.opacity);R(h.blending);var l=g.scale.x*u,g=g.scale.y*w,e=.5*Math.sqrt(l*l+g*g);B.min.set(c.x-e,c.y-e);B.max.set(c.x+e,c.y+e);if(h instanceof THREE.SpriteMaterial){var m=h.map;if(null!==m){e=P[m.id];if(void 0===
e||e.version!==m.version)e=qa(m),P[m.id]=e;if(void 0!==e.canvas){D(e.canvas);var n=m.image,e=n.width*m.offset.x,p=n.height*m.offset.y,k=n.width*m.repeat.x,m=n.height*m.repeat.y,n=l/k,v=g/m;a.save();a.translate(c.x,c.y);0!==h.rotation&&a.rotate(h.rotation);a.translate(-l/2,-g/2);a.scale(n,v);a.translate(-e,-p);a.fillRect(e,p,k,m);a.restore()}}else D(h.color.getStyle()),a.save(),a.translate(c.x,c.y),0!==h.rotation&&a.rotate(h.rotation),a.scale(l,-g),a.fillRect(-.5,-.5,1,1),a.restore()}else h instanceof
THREE.SpriteCanvasMaterial&&(H(h.color.getStyle()),D(h.color.getStyle()),a.save(),a.translate(c.x,c.y),0!==h.rotation&&a.rotate(h.rotation),a.scale(l,g),h.program(a),a.restore())}else if(e instanceof THREE.RenderableLine){if(f=e.v1,r=e.v2,f.positionScreen.x*=u,f.positionScreen.y*=w,r.positionScreen.x*=u,r.positionScreen.y*=w,B.setFromPoints([f.positionScreen,r.positionScreen]),!0===M.intersectsBox(B))if(c=f,h=r,l=e,g=p,Q(g.opacity),R(g.blending),a.beginPath(),a.moveTo(c.positionScreen.x,c.positionScreen.y),
a.lineTo(h.positionScreen.x,h.positionScreen.y),g instanceof THREE.LineBasicMaterial){Z(g.linewidth);aa(g.linecap);ba(g.linejoin);if(g.vertexColors!==THREE.VertexColors)H(g.color.getStyle());else if(e=l.vertexColors[0].getStyle(),l=l.vertexColors[1].getStyle(),e===l)H(e);else{try{var x=a.createLinearGradient(c.positionScreen.x,c.positionScreen.y,h.positionScreen.x,h.positionScreen.y);x.addColorStop(0,e);x.addColorStop(1,l)}catch(J){x=e}H(x)}a.stroke();B.expandByScalar(2*g.linewidth)}else g instanceof
THREE.LineDashedMaterial&&(Z(g.linewidth),aa(g.linecap),ba(g.linejoin),H(g.color.getStyle()),sa([g.dashSize,g.gapSize]),a.stroke(),B.expandByScalar(2*g.linewidth),sa([]))}else if(e instanceof THREE.RenderableFace){f=e.v1;r=e.v2;C=e.v3;if(-1>f.positionScreen.z||1<f.positionScreen.z)continue;if(-1>r.positionScreen.z||1<r.positionScreen.z)continue;if(-1>C.positionScreen.z||1<C.positionScreen.z)continue;f.positionScreen.x*=u;f.positionScreen.y*=w;r.positionScreen.x*=u;r.positionScreen.y*=w;C.positionScreen.x*=
u;C.positionScreen.y*=w;0<p.overdraw&&(ca(f.positionScreen,r.positionScreen,p.overdraw),ca(r.positionScreen,C.positionScreen,p.overdraw),ca(C.positionScreen,f.positionScreen,p.overdraw));B.setFromPoints([f.positionScreen,r.positionScreen,C.positionScreen]);if(!0===M.intersectsBox(B)){h=f;l=r;g=C;c=p;K.info.render.vertices+=3;K.info.render.faces++;Q(c.opacity);R(c.blending);S=h.positionScreen.x;T=h.positionScreen.y;U=l.positionScreen.x;V=l.positionScreen.y;W=g.positionScreen.x;X=g.positionScreen.y;
var p=S,k=T,m=U,n=V,v=W,F=X;a.beginPath();a.moveTo(p,k);a.lineTo(m,n);a.lineTo(v,F);a.closePath();if((c instanceof THREE.MeshLambertMaterial||c instanceof THREE.MeshPhongMaterial)&&null===c.map){ma.copy(c.color);ya.copy(c.emissive);c.vertexColors===THREE.FaceColors&&ma.multiply(e.color);y.copy(oa);Ha.copy(h.positionWorld).add(l.positionWorld).add(g.positionWorld).divideScalar(3);h=Ha;l=e.normalModel;g=y;e=0;for(p=L.length;e<p;e++)k=L[e],na.copy(k.color),k instanceof THREE.DirectionalLight?(m=pa.setFromMatrixPosition(k.matrixWorld).normalize(),
n=l.dot(m),0>=n||(n*=k.intensity,g.add(na.multiplyScalar(n)))):k instanceof THREE.PointLight&&(m=pa.setFromMatrixPosition(k.matrixWorld),n=l.dot(pa.subVectors(m,h).normalize()),0>=n||(n*=0==k.distance?1:1-Math.min(h.distanceTo(m)/k.distance,1),0!=n&&(n*=k.intensity,g.add(na.multiplyScalar(n)))));y.multiply(ma).add(ya);!0===c.wireframe?Y(y,c.wireframeLinewidth,c.wireframeLinecap,c.wireframeLinejoin):O(y)}else c instanceof THREE.MeshBasicMaterial||c instanceof THREE.MeshLambertMaterial||c instanceof
THREE.MeshPhongMaterial?null!==c.map?c.map.mapping===THREE.UVMapping&&(G=e.uvs,ra(S,T,U,V,W,X,G[0].x,G[0].y,G[1].x,G[1].y,G[2].x,G[2].y,c.map)):null!==c.envMap?c.envMap.mapping===THREE.SphericalReflectionMapping&&(z.copy(e.vertexNormalsModel[0]).applyMatrix3(N),za=.5*z.x+.5,Aa=.5*z.y+.5,z.copy(e.vertexNormalsModel[1]).applyMatrix3(N),Ba=.5*z.x+.5,Ca=.5*z.y+.5,z.copy(e.vertexNormalsModel[2]).applyMatrix3(N),Da=.5*z.x+.5,Ea=.5*z.y+.5,ra(S,T,U,V,W,X,za,Aa,Ba,Ca,Da,Ea,c.envMap)):(y.copy(c.color),c.vertexColors===
THREE.FaceColors&&y.multiply(e.color),!0===c.wireframe?Y(y,c.wireframeLinewidth,c.wireframeLinecap,c.wireframeLinejoin):O(y)):(c instanceof THREE.MeshNormalMaterial?(z.copy(e.normalModel).applyMatrix3(N),y.setRGB(z.x,z.y,z.z).multiplyScalar(.5).addScalar(.5)):y.setRGB(1,1,1),!0===c.wireframe?Y(y,c.wireframeLinewidth,c.wireframeLinecap,c.wireframeLinejoin):O(y))}}d.union(B)}}a.setTransform(1,0,0,1,0,0)}}};
